{"version":3,"sources":["webpack:///./src/views/Notification.vue?7b01","webpack:///./src/components/Noti.vue?03ab","webpack:///src/components/Noti.vue","webpack:///./src/components/Noti.vue?cffd","webpack:///./src/components/Noti.vue?a240","webpack:///src/views/Notification.vue","webpack:///./src/views/Notification.vue?0299","webpack:///./src/views/Notification.vue?2ef8","webpack:///./src/components/RecommendUsers.vue?1a4c","webpack:///./src/views/Notification.vue?39d3","webpack:///./src/apis/followships.js","webpack:///./src/components/RecommendUsers.vue?964b","webpack:///src/components/RecommendUsers.vue","webpack:///./src/components/RecommendUsers.vue?aacb","webpack:///./src/components/RecommendUsers.vue?c398","webpack:///./node_modules/core-js/modules/es.array.map.js","webpack:///./src/components/Noti.vue?bb93"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","staticRenderFns","_v","notifications","length","_l","notification","key","Math","random","id","class","read","isRead","on","$event","$router","push","url","catch","style","background","stopPropagation","_s","titleData","_f","createdAt","contentData","_e","data","componentKey","notidata","created","fetchNotifications","$bus","$on","beforeUpdate","readNotifications","beforeDestroy","$off","watch","computed","methods","component","components","Navbar","RecommendUsers","Noti","getToken","localStorage","getItem","addFollowing","userId","apiHelper","post","headers","Authorization","deleteFollowing","delete","more","height","topUsers","user","idx","directives","name","rawName","value","expression","account","isFollowed","fetchTopUsers","followAction","map","action","type","$","$map","arrayMethodHasSpeciesSupport","arrayMethodUsesToLength","HAS_SPECIES_SUPPORT","USES_TO_LENGTH","target","proto","forced","callbackfn","arguments","undefined"],"mappings":"yHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,gBAAgB,CAACF,EAAG,UAAUA,EAAG,QAAQA,EAAG,mBAAmB,IACjLG,EAAkB,G,wBCDlB,EAAS,WAAa,IAAIP,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,QAAQ,CAACF,EAAG,MAAM,CAACE,YAAY,UAAU,CAACN,EAAIQ,GAAG,UAAWR,EAAIS,cAAcC,OAAS,EAAGN,EAAG,MAAMJ,EAAIW,GAAIX,EAAiB,eAAE,SAASY,GAAc,OAAOR,EAAG,MAAM,CAACS,IAAIC,KAAKC,SAAWH,EAAaI,GAAGV,YAAY,YAAYW,MAAM,CAACC,KAAMN,EAAaO,QAAQC,GAAG,CAAC,MAAQ,SAASC,GAAQrB,EAAIsB,QAAQC,KAAKX,EAAaY,KAAKC,OAAM,kBAAkB,CAACrB,EAAG,MAAM,CAACE,YAAY,SAASoB,MAAM,CAAGC,WAAa,OAAUf,EAAmB,OAAI,4BAA+BQ,GAAG,CAAC,MAAQ,SAASC,GAAQA,EAAOO,kBAAkB5B,EAAIsB,QAAQC,KAAM,eAAkBX,EAAqB,UAAIa,OAAM,mBAAmBrB,EAAG,MAAM,CAACE,YAAY,eAAe,CAACF,EAAG,MAAM,CAACE,YAAY,QAAQ,CAACF,EAAG,MAAM,CAACE,YAAY,SAAS,CAACN,EAAIQ,GAAGR,EAAI6B,GAAGjB,EAAakB,cAAc1B,EAAG,MAAM,CAACE,YAAY,QAAQ,CAACN,EAAIQ,GAAG,KAAKR,EAAI6B,GAAG7B,EAAI+B,GAAG,UAAP/B,CAAkBY,EAAaoB,iBAAkBpB,EAAwB,YAAER,EAAG,MAAM,CAACE,YAAY,WAAW,CAACN,EAAIQ,GAAGR,EAAI6B,GAAGjB,EAAaqB,gBAAgBjC,EAAIkC,YAAW,GAAGlC,EAAIkC,KAAmC,IAA7BlC,EAAIS,cAAcC,OAAcN,EAAG,MAAM,CAACE,YAAY,gBAAgB,CAACF,EAAG,MAAM,CAACJ,EAAIQ,GAAG,eAAeR,EAAIkC,QAC/qC,EAAkB,G,wEC0BtB,GACEC,KADF,WAEI,MAAO,CACLC,aAAc,EACd3B,cAAe,GACf4B,SAAU,KAGdC,QARF,WAQA,WACIrC,KAAKsC,qBACLtC,KAAKuC,KAAKC,IAAI,uBAAuB,WACnC,EAAN,0BAGEC,aAdF,WAeIzC,KAAK0C,qBAEPC,cAjBF,WAkBI3C,KAAKuC,KAAKK,KAAK,wBAEjBC,MAAO,CACLrC,cADJ,cAIEsC,SAAU,OAAZ,OAAY,CAAZ,GACA,mDAEEC,QAAS,CACP,mBADJ,WACA,yKACA,mBACA,cACA,WACA,yCAJA,kBAMA,0BANA,gBAMA,EANA,EAMA,KACA,kBACA,oCACA,uCAEA,SAXA,qDAaA,SACA,kBACA,aACA,aACA,uBAjBA,6DAqBI,oBAtBJ,WAsBA,gLACA,0BADA,gBACA,EADA,EACA,KACA,kBACA,oCACA,uCAJA,8CAOI,kBA7BJ,WA6BA,yLAEA,2CAFA,mBAEA,EAFA,EAEA,KACA,qBAHA,sBAIA,qBAJA,0DAOA,aACA,aACA,uBATA,8DCnF8U,I,wBCQ1UC,EAAY,eACd,EACA,EACA,GACA,EACA,KACA,KACA,MAIa,EAAAA,E,QCNf,GACEC,WAAY,CACVC,OAAJ,OACIC,eAAJ,OACIC,KAAJ,ICjBsV,ICQlV,G,UAAY,eACd,EACAtD,EACAQ,GACA,EACA,KACA,KACA,OAIa,e,6CCnBf,W,oFCAA,W,kCCAA,gBACM+C,EAAW,kBAAMC,aAAaC,QAAQ,UAE7B,QACbC,aADa,YACa,IAAVC,EAAU,EAAVA,OACd,OAAOC,OAAUC,KAAK,eAAgB,CAAE5C,GAAI0C,GAAU,CACpDG,QAAS,CAAEC,cAAe,UAAF,OAAYR,SAGxCS,gBANa,YAMgB,IAAVL,EAAU,EAAVA,OACjB,OAAOC,OAAUK,OAAV,uBAAiCN,GAAU,CAChDG,QAAS,CAAEC,cAAe,UAAF,OAAYR,W,oCCX1C,IAAIvD,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,kBAAkBoB,MAAM,CAAE1B,EAAIiE,KAAO,CAAEC,OAAgC,GAAtBlE,EAAImE,SAASzD,OAAc,GAAM,MAAU,CAAEwD,OAAS,WAA2B,CAAC9D,EAAG,MAAM,CAACE,YAAY,SAAS,CAACN,EAAIQ,GAAG,SAASJ,EAAG,MAAM,CAACE,YAAY,cAAcN,EAAIW,GAAIX,EAAY,UAAE,SAASoE,EAAKC,GAAK,OAAOjE,EAAG,MAAM,CAACkE,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASC,SAAUzE,EAAIiE,MAAQI,EAAM,GAAIK,WAAW,wBAAwB7D,IAAIuD,EAAKpD,GAAGV,YAAY,mBAAmB,CAACF,EAAG,MAAM,CAACE,YAAY,SAASoB,MAAM,CAAGC,WAAa,OAAUyC,EAAW,OAAI,4BAA+BhD,GAAG,CAAC,MAAQ,SAASC,GAAQrB,EAAIsB,QAAQC,KAAM,eAAkB6C,EAAO,IAAI3C,OAAM,mBAAmBrB,EAAG,MAAM,CAACE,YAAY,QAAQ,CAACF,EAAG,MAAM,CAACE,YAAY,OAAOc,GAAG,CAAC,MAAQ,SAASC,GAAQrB,EAAIsB,QAAQC,KAAM,eAAkB6C,EAAO,IAAI3C,OAAM,kBAAkB,CAACzB,EAAIQ,GAAGR,EAAI6B,GAAGuC,EAAKG,SAASnE,EAAG,MAAM,CAACE,YAAY,UAAUc,GAAG,CAAC,MAAQ,SAASC,GAAQrB,EAAIsB,QAAQC,KAAM,eAAkB6C,EAAO,IAAI3C,OAAM,kBAAkB,CAACzB,EAAIQ,GAAGR,EAAI6B,GAAGuC,EAAKO,cAAcvE,EAAG,SAAS,CAACkE,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASC,MAAOL,EAAe,WAAEM,WAAW,oBAAoBpE,YAAY,0BAA0Bc,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOrB,EAAI+D,gBAAgBK,EAAKpD,OAAO,CAAChB,EAAIQ,GAAG,UAAUJ,EAAG,SAAS,CAACkE,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASC,OAAQL,EAAKQ,WAAYF,WAAW,qBAAqBpE,YAAY,iBAAiBc,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOrB,EAAIyD,aAAaW,EAAKpD,OAAO,CAAChB,EAAIQ,GAAG,aAAY,GAAGJ,EAAG,MAAM,CAACkE,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASC,OAAQzE,EAAIiE,KAAMS,WAAW,UAAUpE,YAAY,SAASc,GAAG,CAAC,MAAQ,SAASC,GAAQrB,EAAIiE,MAAQjE,EAAIiE,QAAQ,CAACjE,EAAIQ,GAAG,UAAUJ,EAAG,MAAM,CAACkE,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASC,MAAOzE,EAAQ,KAAE0E,WAAW,SAASpE,YAAY,SAASc,GAAG,CAAC,MAAQ,SAASC,GAAQrB,EAAIiE,MAAQjE,EAAIiE,QAAQ,CAACjE,EAAIQ,GAAG,aACl4DD,EAAkB,G,4HCyBtB,GACEgE,KAAM,iBACNpC,KAFF,WAGI,MAAO,CACLgC,SAAU,GACVF,MAAM,IAGV3B,QARF,WAQA,WACIrC,KAAK4E,gBACL5E,KAAKuC,KAAKC,IAAI,gBAAgB,SAAlC,GACM,EAAN,oBAGEG,cAdF,WAeI3C,KAAKuC,KAAKK,KAAK,iBAEjBE,SAAU,OAAZ,OAAY,CAAZ,GACA,mDAEEC,QAAS,CACP,cADJ,WACA,yKACA,mBACA,cACA,WACA,yCAJA,kBAMA,qBANA,gBAMA,EANA,EAMA,KACA,2CACA,QACA,YACA,gBACA,kBACA,8BACA,4BACA,iEACA,SAfA,qDAiBA,kBACA,aACA,aACA,yBApBA,6DAwBI,aAzBJ,SAyBA,4LAEA,gCAFA,mBAEA,EAFA,EAEA,KAEA,qBAJA,sBAKA,qBALA,OAOA,8EAEA,wEACA,wCACA,0BACA,iDACA,0BACA,cACA,uCAIA,uCACA,gBACA,EAEA,iCACA,GADA,IAEA,gCACA,mBA1BA,qDA+BA,aACA,aACA,uBAjCA,6DAqCI,gBA9DJ,SA8DA,4LAEA,mCAFA,mBAEA,EAFA,EAEA,KAEA,qBAJA,sBAKA,qBALA,OAOA,wDACA,uCACA,gBACA,EAEA,iCACA,GADA,IAEA,gCACA,mBAfA,qDAoBA,aACA,aACA,uBAtBA,6DA0BI8B,aAxFJ,SAwFA,GAEM7E,KAAKkE,SAAWlE,KAAKkE,SAASY,KAAI,SAAxC,GACQ,OAAIX,EAAKpD,KAAOgE,EAAOtB,OACdU,EAEA,iCACjB,GADA,IAEYQ,WAA4B,WAAhBI,EAAOC,aC9IyT,I,wBCQpVhC,EAAY,eACd,EACAlD,EACAQ,GACA,EACA,KACA,KACA,MAIa,OAAA0C,E,kEClBf,IAAIiC,EAAI,EAAQ,QACZC,EAAO,EAAQ,QAAgCJ,IAC/CK,EAA+B,EAAQ,QACvCC,EAA0B,EAAQ,QAElCC,EAAsBF,EAA6B,OAEnDG,EAAiBF,EAAwB,OAK7CH,EAAE,CAAEM,OAAQ,QAASC,OAAO,EAAMC,QAASJ,IAAwBC,GAAkB,CACnFR,IAAK,SAAaY,GAChB,OAAOR,EAAKlF,KAAM0F,EAAYC,UAAUlF,OAAS,EAAIkF,UAAU,QAAKC,O,kCCfxE","file":"js/chunk-dd35eea8.cc8f7003.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"notification\"},[_c('Navbar'),_c('Noti'),_c('RecommendUsers')],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"noti\"},[_c('div',{staticClass:\"header\"},[_vm._v(\" 通知 \")]),(_vm.notifications.length > 0)?_c('div',_vm._l((_vm.notifications),function(notification){return _c('div',{key:Math.random() + notification.id,staticClass:\"list-item\",class:{read: notification.isRead},on:{\"click\":function($event){_vm.$router.push(notification.url).catch(function (){})}}},[_c('div',{staticClass:\"avatar\",style:({ background: (\"url(\" + (notification.avatar) + \") no-repeat center/cover\") }),on:{\"click\":function($event){$event.stopPropagation();_vm.$router.push((\"/user/other/\" + (notification.senderId))).catch(function (){})}}}),_c('div',{staticClass:\"top-wrapper\"},[_c('div',{staticClass:\"info\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(notification.titleData))]),_c('div',{staticClass:\"time\"},[_vm._v(\"• \"+_vm._s(_vm._f(\"fromNow\")(notification.createdAt)))])]),(notification.contentData)?_c('div',{staticClass:\"content\"},[_vm._v(_vm._s(notification.contentData))]):_vm._e()])])}),0):_vm._e(),(_vm.notifications.length === 0)?_c('div',{staticClass:\"nothing-here\"},[_c('div',[_vm._v(\"你沒有任何通知\")])]):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"noti\">\n    <div class=\"header\">\n      通知\n    </div>\n    <div v-if=\"notifications.length > 0\">\n      <div @click=\"$router.push(notification.url).catch(()=>{})\" class=\"list-item\" :class=\"{read: notification.isRead}\" v-for=\"notification in notifications\" :key=\"Math.random() + notification.id\">\n        <div class=\"avatar\" :style=\"{ background: `url(${notification.avatar}) no-repeat center/cover` }\" @click.stop=\"$router.push(`/user/other/${notification.senderId}`).catch(()=>{})\"></div>\n        <div class=\"top-wrapper\">\n          <div class=\"info\">\n            <div class=\"title\">{{ notification.titleData }}</div>\n            <div class=\"time\">&bull; {{ notification.createdAt | fromNow }}</div>\n          </div>\n          <div v-if=\"notification.contentData\" class=\"content\">{{ notification.contentData }}</div>\n        </div>\n      </div>\n    </div>\n    <div class=\"nothing-here\" v-if=\"notifications.length === 0\">\n       <div>你沒有任何通知</div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport subscribeAPI from '@/apis/subscribes'\nimport { Toast } from '@/utils/helpers'\nimport { mapState } from 'vuex'\nexport default {\n  data() {\n    return {\n      componentKey: 0,\n      notifications: [],\n      notidata: []\n    }\n  },\n  created () {\n    this.fetchNotifications()\n    this.$bus.$on('updateNotifications', () => {\n      this.updateNotifications()\n    })\n  },\n  beforeUpdate () {\n    this.readNotifications()\n  },\n  beforeDestroy () {\n    this.$bus.$off('updateNotifications')\n  },\n  watch: {\n    notifications () {\n    }\n  },\n  computed: {\n    ...mapState(['currentUser', 'isAuthenticated']),\n  },\n  methods: {\n    async fetchNotifications () {\n      const loader = this.$loading.show({\n        isFullPage: true,\n        opacity: 1\n      }, { default: this.$createElement('MyLoading') })\n      try {\n        const { data } = await subscribeAPI.getNotifications()\n        this.notifications = data\n        this.notifications .sort((a, b) => {\n          return a.createdAt < b.createdAt ? 1 : -1\n        })\n        loader.hide()\n      } catch (error) {\n        loader.hide()\n        console.log(error)\n        Toast.fire({\n          icon: 'error',\n          title: '目前無法取得通知，請稍候'\n        })\n      }\n    },\n    async updateNotifications () {\n      const { data } = await subscribeAPI.getNotifications()\n      this.notifications = data\n      this.notifications .sort((a, b) => {\n        return a.createdAt < b.createdAt ? 1 : -1\n      })\n    },\n    async readNotifications () {\n      try {\n        const { data } = await subscribeAPI.readNotifications(this.currentUser.id)\n        if (data.status !== 'success') {\n          throw new Error(data.message)\n        }\n      } catch (error) {\n        Toast.fire({\n          icon: 'error',\n          title: '目前無法已讀通知，請稍候'\n        })\n      }\n    }\n  }\n}\n\n</script>\n\n<style lang=\"scss\">\n$orange: #FF6600;\n$deeporange: #F34A16;\n$lightdark: #9197A3;\n$lightgray: #F5F8FA;\n$divider: #E6ECF0;\n$bitdark: #657786;\n.noti {\n  max-height: 100vh;\n  overflow-y: scroll;\n  overflow-x: hidden;\n  width: 100%;\n  border: 1px solid $divider;\n  max-width: 600px;\n  padding: 0;\n  .header {\n    border-bottom: 1px solid $divider;\n    height: 55px;\n    padding: 15px 0 15px 15px;\n    line-height: 26px;\n    font-size: 18px;\n    font-weight: 700;\n    text-align: left;\n  }\n  .list-item {\n    padding: 10px 0 10px 0;\n    border-bottom: 1px solid $divider;\n    display: flex;\n    flex-direction: row;\n    position: relative;\n    cursor: pointer;\n    transition: ease-in 0.2s;\n    &:hover {\n      backdrop-filter: brightness(.95);\n    }\n    .avatar {\n      height: 50px;\n      min-width: 50px;\n      border-radius: 100px;\n      margin: 3px 0 0 15px;\n      background: $bitdark;\n      cursor: pointer;\n      &:hover {\n        filter: brightness(.9);\n      }\n    }\n    .top-wrapper {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      margin-left: 10px;\n      .info {\n        width: 100%;\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        height: 22px;\n        line-height: 22px;\n        .title {\n          font-weight: 700;\n          margin-right: 5px;\n          cursor: pointer;\n        }\n        .time {\n          font-weight: 500;\n          font-size: 15px;\n          line-height: 22px;\n          color: #657786;\n          text-align: start;\n        }\n      }\n      .content {\n        margin-top: 5px;\n        width: 100%;\n        max-width: 510px;\n        overflow: hidden;\n        font-size: 15px;\n        color: $bitdark;\n        font-weight: 500;\n        line-height: 22px;\n        text-align: left;\n      }\n    }\n  }\n  .list-item.read {\n    background: $lightgray;\n    transition: ease-in 0.2s;\n    &:hover {\n      filter: brightness(.95);\n    }\n  }\n  .nothing-here {\n    height: 100%;\n    width: 100%;\n    font-size: 22px;\n    font-weight: 500;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n}\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Noti.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Noti.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Noti.vue?vue&type=template&id=69866614&\"\nimport script from \"./Noti.vue?vue&type=script&lang=js&\"\nexport * from \"./Noti.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Noti.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div class=\"notification\">\n    <Navbar></Navbar>\n    <Noti></Noti>\n    <RecommendUsers></RecommendUsers>\n  </div>\n</template>\n\n<script>\nimport Navbar from '@/components/Navbar.vue'\nimport RecommendUsers from '@/components/RecommendUsers.vue'\nimport Noti from '@/components/Noti.vue'\n\nexport default {\n  components: {\n    Navbar,\n    RecommendUsers,\n    Noti\n  }\n}\n\n</script>\n\n<style lang=\"scss\">\n$orange: #FF6600;\n$deeporange: #F34A16;\n$lightdark: #9197A3;\n$divider: #E6ECF0;\n.notification {\n  height: 100%;\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Notification.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Notification.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Notification.vue?vue&type=template&id=2a80189a&\"\nimport script from \"./Notification.vue?vue&type=script&lang=js&\"\nexport * from \"./Notification.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Notification.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RecommendUsers.vue?vue&type=style&index=0&lang=scss&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Notification.vue?vue&type=style&index=0&lang=scss&\"","import { apiHelper } from './../utils/helpers'\nconst getToken = () => localStorage.getItem('token')\n\nexport default {\n  addFollowing ({ userId }) {\n    return apiHelper.post('/followships', { id: userId }, {\n      headers: { Authorization: `Bearer ${getToken()}` }\n    })\n  },\n  deleteFollowing ({ userId }) {\n    return apiHelper.delete(`/followships/${userId}`, {\n      headers: { Authorization: `Bearer ${getToken()}` }\n    })\n  }\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"recommend-users\",style:([_vm.more ? { height: ((_vm.topUsers.length * 71 + 92) + \"px\") } : { height:  ((5 * 71 + 92) + \"px\")}])},[_c('div',{staticClass:\"title\"},[_vm._v(\"跟隨誰\")]),_c('div',{staticClass:\"list-group\"},_vm._l((_vm.topUsers),function(user,idx){return _c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!(!_vm.more && idx > 4)),expression:\"!(!more && idx > 4)\"}],key:user.id,staticClass:\"list-group-item\"},[_c('div',{staticClass:\"avatar\",style:({ background: (\"url(\" + (user.avatar) + \") no-repeat center/cover\") }),on:{\"click\":function($event){_vm.$router.push((\"/user/other/\" + (user.id))).catch(function (){})}}}),_c('div',{staticClass:\"info\"},[_c('div',{staticClass:\"name\",on:{\"click\":function($event){_vm.$router.push((\"/user/other/\" + (user.id))).catch(function (){})}}},[_vm._v(_vm._s(user.name))]),_c('div',{staticClass:\"account\",on:{\"click\":function($event){_vm.$router.push((\"/user/other/\" + (user.id))).catch(function (){})}}},[_vm._v(_vm._s(user.account))])]),_c('button',{directives:[{name:\"show\",rawName:\"v-show\",value:(user.isFollowed),expression:\"user.isFollowed\"}],staticClass:\"btn btn-follow unfollow\",on:{\"click\":function($event){return _vm.deleteFollowing(user.id)}}},[_vm._v(\"正在跟隨\")]),_c('button',{directives:[{name:\"show\",rawName:\"v-show\",value:(!user.isFollowed),expression:\"!user.isFollowed\"}],staticClass:\"btn btn-follow\",on:{\"click\":function($event){return _vm.addFollowing(user.id)}}},[_vm._v(\"跟隨\")])])}),0),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.more),expression:\"!more\"}],staticClass:\"footer\",on:{\"click\":function($event){_vm.more = !_vm.more}}},[_vm._v(\"顯示更多\")]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.more),expression:\"more\"}],staticClass:\"footer\",on:{\"click\":function($event){_vm.more = !_vm.more}}},[_vm._v(\"顯示更少\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"recommend-users\" :style=\"[more ? { height: `${topUsers.length * 71 + 92}px` } : { height:  `${5 * 71 + 92}px`}]\">\n    <div class=\"title\">跟隨誰</div>\n    <div class=\"list-group\">\n      <div v-show=\"!(!more && idx > 4)\" v-for=\"(user, idx) in topUsers\" :key=\"user.id\" class=\"list-group-item\">\n        <div class=\"avatar\" @click=\"$router.push(`/user/other/${user.id}`).catch(()=>{})\" :style=\"{ background: `url(${user.avatar}) no-repeat center/cover` }\"></div>\n        <div class=\"info\">\n          <div class=\"name\" @click=\"$router.push(`/user/other/${user.id}`).catch(()=>{})\">{{ user.name }}</div>\n          <div class=\"account\" @click=\"$router.push(`/user/other/${user.id}`).catch(()=>{})\">{{ user.account }}</div>\n        </div>\n        <button v-show=\"user.isFollowed\" class=\"btn btn-follow unfollow\" @click=\"deleteFollowing(user.id)\">正在跟隨</button>\n        <button v-show=\"!user.isFollowed\" class=\"btn btn-follow\" @click=\"addFollowing(user.id)\">跟隨</button>\n      </div>\n    </div>\n    <div v-show=\"!more\" class=\"footer\" @click=\"more = !more\">顯示更多</div>\n    <div v-show=\"more\" class=\"footer\" @click=\"more = !more\">顯示更少</div>\n  </div>\n</template>\n\n<script>\n\nimport followshipsAPI from '@/apis/followships'\nimport usersAPI from '@/apis/users'\nimport { Toast } from '@/utils/helpers'\nimport { mapState } from 'vuex'\n\nexport default {\n  name: 'RecommendUsers',\n  data () {\n    return {\n      topUsers: [],\n      more: false\n    }\n  },\n  created () {\n    this.fetchTopUsers()\n    this.$bus.$on('followAction', action => {\n      this.followAction(action)\n    })\n  },\n  beforeDestroy () {\n    this.$bus.$off('followAction')\n  },\n  computed: {\n    ...mapState(['currentUser', 'isAuthenticated'])\n  },\n  methods: {\n    async fetchTopUsers () {\n      const loader = this.$loading.show({\n        isFullPage: true,\n        opacity: 1\n      }, { default: this.$createElement('MyLoading') })\n      try {\n        const { data } = await usersAPI.getTopUsers()\n        this.topUsers = data.users.map(user => ({\n          id: user.id,\n          name: user.name,\n          avatar: user.avatar,\n          account: user.account,\n          followerCount: user.FollowerCount,\n          isFollowed: user.isFollowed\n        })).filter(user => user.id !== this.currentUser.id).slice(0, 8)\n        loader.hide()\n      } catch (error) {\n        console.log(error)\n        Toast.fire({\n          icon: 'error',\n          title: '目前無法為你推薦追蹤，請稍候'\n        })\n      }\n    },\n    async addFollowing (userId) {\n      try {\n        const { data } = await followshipsAPI.addFollowing({ userId })\n\n        if (data.status !== 'success') {\n          throw new Error(data.message)\n        }\n        this.$bus.$emit('followAction', { type: 'follow', userId: userId, followship: data.followship})\n\n        if (data.followship.followerId > 0 && data.followship.followingId !== this.currentUser.id) {\n          this.$socket.emit('personal notification', {\n            senderId: this.currentUser.id,\n            titleData: `${this.currentUser.name} 開始追蹤你`,\n            url: `/user/self/follower`,\n            type: 'follow',\n            recipientId: data.followship.followingId\n          })\n        }\n\n        this.topUsers = this.topUsers.map(user => {\n          if (user.id !== userId) {\n            return user\n          } else {\n            return {\n              ...user,\n              followerCount: user.followerCount + 1,\n              isFollowed: true\n            }\n          }\n        })\n      } catch (error) {\n        Toast.fire({\n          icon: 'error',\n          title: '無法加入追蹤，請稍後再試'\n        })\n      }\n    },\n    async deleteFollowing (userId) {\n      try {\n        const { data } = await followshipsAPI.deleteFollowing({ userId })\n\n        if (data.status !== 'success') {\n          throw new Error(data.message)\n        }\n        this.$bus.$emit('followAction', { type: 'unfollow', userId: userId})\n        this.topUsers = this.topUsers.map(user => {\n          if (user.id !== userId) {\n            return user\n          } else {\n            return {\n              ...user,\n              followerCount: user.followerCount - 1,\n              isFollowed: false\n            }\n          }\n        })\n      } catch (error) {\n        Toast.fire({\n          icon: 'error',\n          title: '無法取消追蹤，請稍後再試'\n        })\n      }\n    },\n    followAction (action) {\n\n      this.topUsers = this.topUsers.map(user => {\n        if (user.id !== action.userId) {\n          return user\n        } else {\n          return {\n            ...user,\n            isFollowed: action.type === 'follow' ? true : false \n          }\n        }\n      })\n    }\n  }\n}\n\n</script>\n\n<style lang=\"scss\">\n$orange: #FF6600;\n$deeporange: #F34A16;\n$lightgray: #F5F8FA;\n$bitdark: #657786;\n$divider: #E6ECF0;\n.recommend-users {\n  width: 100%;\n  max-width: 350px;\n  height: 517px;\n  margin: 15px 82px 0 30px;\n  border-radius: 14px;\n  background: $lightgray;\n  .title {\n    margin-top: 10px;\n    text-align: left;\n    padding: 0px 0 0 15px; \n    font-size: 18px;\n    line-height: 26px;\n    height: 36px;\n    font-weight: 700;\n  }\n  .list-group {\n    border: none;\n    .list-group-item {\n      position: relative;\n      border: none;\n      border-radius: 0;\n      border-top: 1px solid $divider;\n      border-bottom: 1px solid $divider;\n      height: 71px;\n      padding: 10px 15px 0 15px;\n      background: none;\n      display: flex;\n      flex-direction: row;\n      align-items: flex-start;\n      cursor: pointer;\n      transition: ease-in 0.2s;\n      &:hover {\n        backdrop-filter: brightness(.95);\n      }\n      .avatar {\n        margin-right: 10px;\n        height: 50px;\n        width: 50px;\n        border-radius: 50%;\n        cursor: pointer;\n        &:hover {\n          filter: brightness(.9);\n        }\n      }\n      .info {\n        margin-top: 8px;\n        display: flex;\n        flex-direction: column;\n        .name {\n          text-align: left;\n          margin-bottom: 3px;\n          font-size: 15px;\n          line-height: 15px;\n          font-weight: 700;\n          cursor: pointer;\n          &:hover {\n            text-decoration: underline;\n          }\n        }\n        .account {\n          text-align: left;\n          font-size: 15px;\n          line-height: 15px;\n          font-weight: 700;\n          color: $bitdark;\n          cursor: pointer;\n          &:hover {\n            text-decoration: underline;\n          }\n        }\n      }\n      .btn-follow {\n        width: 100%;\n        max-width: 62px;\n        position: absolute;\n        top: 20px;\n        right: 15px;\n        height: 30px;\n        line-height: 15px;\n        margin-left: auto;\n        border: 1px solid $orange ;\n        background: none;\n        font-size: 15px;\n        font-weight: 700;\n        color: $orange;\n        border-radius: 100px;\n        transition: ease-in 0.2s;\n        &:hover {\n          box-shadow: 0 0 3px 1px $bitdark;\n          background-color: $orange;\n          color: #ffffff;\n        }\n      }\n      .btn-follow.unfollow {\n        max-width: 92px;\n        background: $orange;\n        color: #ffffff;\n        &:hover {\n          background-color: $deeporange;\n        }\n      }\n    }\n  }\n  .footer {\n    margin-bottom: auto;\n    height: 22px;\n    line-height: 22px;\n    max-width: 60px;\n    margin: 12px 0 12px 15px;\n    text-align: left;\n    font-weight: normal;\n    font-size: 15px;\n    color: $orange;\n    cursor: pointer;\n    transition: ease-in 0.2s;\n    &:hover {\n      text-decoration: underline;\n      color: $deeporange;\n      font-weight: bold;\n    }\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RecommendUsers.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RecommendUsers.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RecommendUsers.vue?vue&type=template&id=516f4cd0&\"\nimport script from \"./RecommendUsers.vue?vue&type=script&lang=js&\"\nexport * from \"./RecommendUsers.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RecommendUsers.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","'use strict';\nvar $ = require('../internals/export');\nvar $map = require('../internals/array-iteration').map;\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('map');\n// FF49- issue\nvar USES_TO_LENGTH = arrayMethodUsesToLength('map');\n\n// `Array.prototype.map` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.map\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  map: function map(callbackfn /* , thisArg */) {\n    return $map(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Noti.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}