(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dd35eea8"],{"109a":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"notification"},[n("Navbar"),n("Noti"),n("RecommendUsers")],1)},r=[],i=n("d178"),a=n("88fd"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"noti"},[n("div",{staticClass:"header"},[t._v(" 通知 ")]),t.notifications.length>0?n("div",t._l(t.notifications,(function(e){return n("div",{key:Math.random()+e.id,staticClass:"list-item",class:{read:e.isRead},on:{click:function(n){t.$router.push(e.url).catch((function(){}))}}},[n("div",{staticClass:"avatar",style:{background:"url("+e.avatar+") no-repeat center/cover"},on:{click:function(n){n.stopPropagation(),t.$router.push("/user/other/"+e.senderId).catch((function(){}))}}}),n("div",{staticClass:"top-wrapper"},[n("div",{staticClass:"info"},[n("div",{staticClass:"title"},[t._v(t._s(e.titleData))]),n("div",{staticClass:"time"},[t._v("• "+t._s(t._f("fromNow")(e.createdAt)))])]),e.contentData?n("div",{staticClass:"content"},[t._v(t._s(e.contentData))]):t._e()])])})),0):t._e(),0===t.notifications.length?n("div",{staticClass:"nothing-here"},[n("div",[t._v("你沒有任何通知")])]):t._e()])},c=[],u=(n("96cf"),n("1da1")),l=n("5530"),f=n("a7a7"),d=n("2fa3"),h=n("2f62"),p={data:function(){return{componentKey:0,notifications:[],notidata:[]}},created:function(){var t=this;this.fetchNotifications(),this.$bus.$on("updateNotifications",(function(){t.updateNotifications()}))},beforeUpdate:function(){this.readNotifications()},beforeDestroy:function(){this.$bus.$off("updateNotifications")},watch:{notifications:function(){}},computed:Object(l["a"])({},Object(h["b"])(["currentUser","isAuthenticated"])),methods:{fetchNotifications:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.$loading.show({isFullPage:!0,opacity:1},{default:t.$createElement("MyLoading")}),e.prev=1,e.next=4,f["a"].getNotifications();case 4:o=e.sent,r=o.data,t.notifications=r,t.notifications.sort((function(t,e){return t.createdAt<e.createdAt?1:-1})),n.hide(),e.next=16;break;case 11:e.prev=11,e.t0=e["catch"](1),n.hide(),console.log(e.t0),d["a"].fire({icon:"error",title:"目前無法取得通知，請稍候"});case 16:case"end":return e.stop()}}),e,null,[[1,11]])})))()},updateNotifications:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"].getNotifications();case 2:n=e.sent,o=n.data,t.notifications=o,t.notifications.sort((function(t,e){return t.createdAt<e.createdAt?1:-1}));case 6:case"end":return e.stop()}}),e)})))()},readNotifications:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f["a"].readNotifications(t.currentUser.id);case 3:if(n=e.sent,o=n.data,"success"===o.status){e.next=7;break}throw new Error(o.message);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),d["a"].fire({icon:"error",title:"目前無法已讀通知，請稍候"});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()}}},v=p,w=(n("df39"),n("2877")),m=Object(w["a"])(v,s,c,!1,null,null,null),b=m.exports,g={components:{Navbar:i["a"],RecommendUsers:a["a"],Noti:b}},k=g,x=(n("6496"),Object(w["a"])(k,o,r,!1,null,null,null));e["default"]=x.exports},"46ed":function(t,e,n){"use strict";n("ca8f")},"5c15":function(t,e,n){},"62eb":function(t,e,n){},6496:function(t,e,n){"use strict";n("5c15")},8845:function(t,e,n){"use strict";var o=n("2fa3"),r=function(){return localStorage.getItem("token")};e["a"]={addFollowing:function(t){var e=t.userId;return o["b"].post("/followships",{id:e},{headers:{Authorization:"Bearer ".concat(r())}})},deleteFollowing:function(t){var e=t.userId;return o["b"].delete("/followships/".concat(e),{headers:{Authorization:"Bearer ".concat(r())}})}}},"88fd":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"recommend-users",style:[t.more?{height:71*t.topUsers.length+92+"px"}:{height:"447px"}]},[n("div",{staticClass:"title"},[t._v("跟隨誰")]),n("div",{staticClass:"list-group"},t._l(t.topUsers,(function(e,o){return n("div",{directives:[{name:"show",rawName:"v-show",value:!(!t.more&&o>4),expression:"!(!more && idx > 4)"}],key:e.id,staticClass:"list-group-item"},[n("div",{staticClass:"avatar",style:{background:"url("+e.avatar+") no-repeat center/cover"},on:{click:function(n){t.$router.push("/user/other/"+e.id).catch((function(){}))}}}),n("div",{staticClass:"info"},[n("div",{staticClass:"name",on:{click:function(n){t.$router.push("/user/other/"+e.id).catch((function(){}))}}},[t._v(t._s(e.name))]),n("div",{staticClass:"account",on:{click:function(n){t.$router.push("/user/other/"+e.id).catch((function(){}))}}},[t._v(t._s(e.account))])]),n("button",{directives:[{name:"show",rawName:"v-show",value:e.isFollowed,expression:"user.isFollowed"}],staticClass:"btn btn-follow unfollow",on:{click:function(n){return t.deleteFollowing(e.id)}}},[t._v("正在跟隨")]),n("button",{directives:[{name:"show",rawName:"v-show",value:!e.isFollowed,expression:"!user.isFollowed"}],staticClass:"btn btn-follow",on:{click:function(n){return t.addFollowing(e.id)}}},[t._v("跟隨")])])})),0),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.more,expression:"!more"}],staticClass:"footer",on:{click:function(e){t.more=!t.more}}},[t._v("顯示更多")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.more,expression:"more"}],staticClass:"footer",on:{click:function(e){t.more=!t.more}}},[t._v("顯示更少")])])},r=[],i=(n("4de4"),n("d81d"),n("fb6a"),n("b0c0"),n("96cf"),n("1da1")),a=n("5530"),s=n("8845"),c=n("4cce"),u=n("2fa3"),l=n("2f62"),f={name:"RecommendUsers",data:function(){return{topUsers:[],more:!1}},created:function(){var t=this;this.fetchTopUsers(),this.$bus.$on("followAction",(function(e){t.followAction(e)}))},beforeDestroy:function(){this.$bus.$off("followAction")},computed:Object(a["a"])({},Object(l["b"])(["currentUser","isAuthenticated"])),methods:{fetchTopUsers:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.$loading.show({isFullPage:!0,opacity:1},{default:t.$createElement("MyLoading")}),e.prev=1,e.next=4,c["a"].getTopUsers();case 4:o=e.sent,r=o.data,t.topUsers=r.users.map((function(t){return{id:t.id,name:t.name,avatar:t.avatar,account:t.account,followerCount:t.FollowerCount,isFollowed:t.isFollowed}})).filter((function(e){return e.id!==t.currentUser.id})).slice(0,8),n.hide(),e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](1),console.log(e.t0),u["a"].fire({icon:"error",title:"目前無法為你推薦追蹤，請稍候"});case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))()},addFollowing:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s["a"].addFollowing({userId:t});case 3:if(o=n.sent,r=o.data,"success"===r.status){n.next=7;break}throw new Error(r.message);case 7:e.$bus.$emit("followAction",{type:"follow",userId:t,followship:r.followship}),r.followship.followerId>0&&r.followship.followingId!==e.currentUser.id&&e.$socket.emit("personal notification",{senderId:e.currentUser.id,titleData:"".concat(e.currentUser.name," 開始追蹤你"),url:"/user/self/follower",type:"follow",recipientId:r.followship.followingId}),e.topUsers=e.topUsers.map((function(e){return e.id!==t?e:Object(a["a"])(Object(a["a"])({},e),{},{followerCount:e.followerCount+1,isFollowed:!0})})),n.next=15;break;case 12:n.prev=12,n.t0=n["catch"](0),u["a"].fire({icon:"error",title:"無法加入追蹤，請稍後再試"});case 15:case"end":return n.stop()}}),n,null,[[0,12]])})))()},deleteFollowing:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s["a"].deleteFollowing({userId:t});case 3:if(o=n.sent,r=o.data,"success"===r.status){n.next=7;break}throw new Error(r.message);case 7:e.$bus.$emit("followAction",{type:"unfollow",userId:t}),e.topUsers=e.topUsers.map((function(e){return e.id!==t?e:Object(a["a"])(Object(a["a"])({},e),{},{followerCount:e.followerCount-1,isFollowed:!1})})),n.next=14;break;case 11:n.prev=11,n.t0=n["catch"](0),u["a"].fire({icon:"error",title:"無法取消追蹤，請稍後再試"});case 14:case"end":return n.stop()}}),n,null,[[0,11]])})))()},followAction:function(t){this.topUsers=this.topUsers.map((function(e){return e.id!==t.userId?e:Object(a["a"])(Object(a["a"])({},e),{},{isFollowed:"follow"===t.type})}))}}},d=f,h=(n("46ed"),n("2877")),p=Object(h["a"])(d,o,r,!1,null,null,null);e["a"]=p.exports},ca8f:function(t,e,n){},d81d:function(t,e,n){"use strict";var o=n("23e7"),r=n("b727").map,i=n("1dde"),a=n("ae40"),s=i("map"),c=a("map");o({target:"Array",proto:!0,forced:!s||!c},{map:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},df39:function(t,e,n){"use strict";n("62eb")}}]);
//# sourceMappingURL=chunk-dd35eea8.cc8f7003.js.map