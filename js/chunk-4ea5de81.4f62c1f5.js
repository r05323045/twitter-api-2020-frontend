(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ea5de81"],{"0972":function(e,t,r){},"2d27":function(e,t,r){"use strict";r("60b8")},"46ed":function(e,t,r){"use strict";r("ca8f")},"4c78":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.tweets?r("div",{staticClass:"tweet-list"},e._l(e.tweets,(function(t){return r("div",{key:t.id+"-"+Math.random(),staticClass:"list-item",on:{click:function(r){return e.tweetDetail(t)}}},[r("div",{staticClass:"avatar",style:{background:"url("+t.avatar+") no-repeat center/cover"},on:{click:function(r){r.stopPropagation(),e.$router.push("/user/other/"+t.userId).catch((function(){}))}}}),r("div",{staticClass:"tweet-wrapper"},[r("div",{staticClass:"info"},[r("div",{staticClass:"name",on:{click:function(r){e.$router.push("/user/other/"+t.userId).catch((function(){}))}}},[e._v(e._s(t.name))]),r("div",{staticClass:"account-and-post-time"},[r("span",{staticClass:"account",on:{click:function(r){e.$router.push("/user/other/"+t.userId).catch((function(){}))}}},[e._v(e._s(t.account)+" ")]),e._v("• "),r("span",[e._v(e._s(e._f("fromNow")(t.createdAt)))])])]),r("div",{directives:[{name:"show",rawName:"v-show",value:"reply"===t.type,expression:"tweet.type === 'reply'"}],staticClass:"reply-to-wrapper"},[r("span",{staticClass:"title"},[e._v("回覆 ")]),r("span",{staticClass:"name"},[e._v(e._s(t.replyTo))])]),r("div",{staticClass:"content"},[e._v(e._s(t.description))]),r("div",{directives:[{name:"show",rawName:"v-show",value:"reply"!==t.type,expression:"tweet.type !== 'reply'"}],staticClass:"action"},[r("div",{staticClass:"reply-wrapper"},[r("div",{staticClass:"icon reply"}),r("span",{staticClass:"number"},[e._v(e._s(t.replyTweetCount))])]),r("div",{staticClass:"like-wrapper"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLiked,expression:"!tweet.isLiked"}],staticClass:"icon like",on:{click:function(r){return r.stopPropagation(),e.likeTweet(t.id)}}}),r("div",{directives:[{name:"show",rawName:"v-show",value:t.isLiked,expression:"tweet.isLiked"}],staticClass:"icon like liked",on:{click:function(r){return r.stopPropagation(),e.unlikeTweet(t.id)}}}),r("span",{staticClass:"number"},[e._v(e._s(t.likeTweetCount))])])])])])})),0):e._e()},s=[],i=(r("b0c0"),r("96cf"),r("1da1")),a=r("5530"),o=r("c058"),c=r("2fa3"),u=r("2f62"),l={name:"TweetList",props:{tweets:{type:Array,default:function(){return[]}},isReply:Boolean},computed:Object(a["a"])({},Object(u["b"])(["currentUser","isAuthenticated"])),methods:{tweetDetail:function(e){this.isReply?this.$router.push("/reply_list/".concat(e.TweetId)):this.$router.push("/reply_list/".concat(e.id))},likeTweet:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,o["a"].likeTweet({tweetId:e});case 3:if(n=r.sent,s=n.data,"success"===s.status){r.next=7;break}throw new Error(s.message);case 7:t.$bus.$emit("tweetAction",{type:"like",tweetId:e,tweetUserId:s.tweet.UserId}),s.tweet.UserId>0&&s.tweet.UserId!==t.currentUser.id&&t.$socket.emit("personal notification",{senderId:t.currentUser.id,titleData:"".concat(t.currentUser.name," 喜歡你的貼文"),url:"/reply_list/".concat(e),type:"like",recipientId:s.tweet.UserId}),r.next=15;break;case 11:r.prev=11,r.t0=r["catch"](0),console.log(r.t0),c["a"].fire({icon:"error",title:"無法按讚推文，請稍後再試"});case 15:case"end":return r.stop()}}),r,null,[[0,11]])})))()},unlikeTweet:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,o["a"].unlikeTweet({tweetId:e});case 3:if(n=r.sent,s=n.data,"success"===s.status){r.next=7;break}throw new Error(s.message);case 7:t.$bus.$emit("tweetAction",{type:"unlike",tweetId:e}),r.next=14;break;case 10:r.prev=10,r.t0=r["catch"](0),console.log(r.t0),c["a"].fire({icon:"error",title:"無法取消按讚，請稍後再試"});case 14:case"end":return r.stop()}}),r,null,[[0,10]])})))()}}},d=l,w=(r("2d27"),r("2877")),p=Object(w["a"])(d,n,s,!1,null,null,null);t["a"]=p.exports},"60b8":function(e,t,r){},8845:function(e,t,r){"use strict";var n=r("2fa3"),s=function(){return localStorage.getItem("token")};t["a"]={addFollowing:function(e){var t=e.userId;return n["b"].post("/followships",{id:t},{headers:{Authorization:"Bearer ".concat(s())}})},deleteFollowing:function(e){var t=e.userId;return n["b"].delete("/followships/".concat(t),{headers:{Authorization:"Bearer ".concat(s())}})}}},"88fd":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"recommend-users",style:[e.more?{height:71*e.topUsers.length+92+"px"}:{height:"447px"}]},[r("div",{staticClass:"title"},[e._v("跟隨誰")]),r("div",{staticClass:"list-group"},e._l(e.topUsers,(function(t,n){return r("div",{directives:[{name:"show",rawName:"v-show",value:!(!e.more&&n>4),expression:"!(!more && idx > 4)"}],key:t.id,staticClass:"list-group-item"},[r("div",{staticClass:"avatar",style:{background:"url("+t.avatar+") no-repeat center/cover"},on:{click:function(r){e.$router.push("/user/other/"+t.id).catch((function(){}))}}}),r("div",{staticClass:"info"},[r("div",{staticClass:"name",on:{click:function(r){e.$router.push("/user/other/"+t.id).catch((function(){}))}}},[e._v(e._s(t.name))]),r("div",{staticClass:"account",on:{click:function(r){e.$router.push("/user/other/"+t.id).catch((function(){}))}}},[e._v(e._s(t.account))])]),r("button",{directives:[{name:"show",rawName:"v-show",value:t.isFollowed,expression:"user.isFollowed"}],staticClass:"btn btn-follow unfollow",on:{click:function(r){return e.deleteFollowing(t.id)}}},[e._v("正在跟隨")]),r("button",{directives:[{name:"show",rawName:"v-show",value:!t.isFollowed,expression:"!user.isFollowed"}],staticClass:"btn btn-follow",on:{click:function(r){return e.addFollowing(t.id)}}},[e._v("跟隨")])])})),0),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.more,expression:"!more"}],staticClass:"footer",on:{click:function(t){e.more=!e.more}}},[e._v("顯示更多")]),r("div",{directives:[{name:"show",rawName:"v-show",value:e.more,expression:"more"}],staticClass:"footer",on:{click:function(t){e.more=!e.more}}},[e._v("顯示更少")])])},s=[],i=(r("4de4"),r("d81d"),r("fb6a"),r("b0c0"),r("96cf"),r("1da1")),a=r("5530"),o=r("8845"),c=r("4cce"),u=r("2fa3"),l=r("2f62"),d={name:"RecommendUsers",data:function(){return{topUsers:[],more:!1}},created:function(){var e=this;this.fetchTopUsers(),this.$bus.$on("followAction",(function(t){e.followAction(t)}))},beforeDestroy:function(){this.$bus.$off("followAction")},computed:Object(a["a"])({},Object(l["b"])(["currentUser","isAuthenticated"])),methods:{fetchTopUsers:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$loading.show({isFullPage:!0,opacity:1},{default:e.$createElement("MyLoading")}),t.prev=1,t.next=4,c["a"].getTopUsers();case 4:n=t.sent,s=n.data,e.topUsers=s.users.map((function(e){return{id:e.id,name:e.name,avatar:e.avatar,account:e.account,followerCount:e.FollowerCount,isFollowed:e.isFollowed}})).filter((function(t){return t.id!==e.currentUser.id})).slice(0,8),r.hide(),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](1),console.log(t.t0),u["a"].fire({icon:"error",title:"目前無法為你推薦追蹤，請稍候"});case 14:case"end":return t.stop()}}),t,null,[[1,10]])})))()},addFollowing:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,o["a"].addFollowing({userId:e});case 3:if(n=r.sent,s=n.data,"success"===s.status){r.next=7;break}throw new Error(s.message);case 7:t.$bus.$emit("followAction",{type:"follow",userId:e,followship:s.followship}),s.followship.followerId>0&&s.followship.followingId!==t.currentUser.id&&t.$socket.emit("personal notification",{senderId:t.currentUser.id,titleData:"".concat(t.currentUser.name," 開始追蹤你"),url:"/user/self/follower",type:"follow",recipientId:s.followship.followingId}),t.topUsers=t.topUsers.map((function(t){return t.id!==e?t:Object(a["a"])(Object(a["a"])({},t),{},{followerCount:t.followerCount+1,isFollowed:!0})})),r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](0),u["a"].fire({icon:"error",title:"無法加入追蹤，請稍後再試"});case 15:case"end":return r.stop()}}),r,null,[[0,12]])})))()},deleteFollowing:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,o["a"].deleteFollowing({userId:e});case 3:if(n=r.sent,s=n.data,"success"===s.status){r.next=7;break}throw new Error(s.message);case 7:t.$bus.$emit("followAction",{type:"unfollow",userId:e}),t.topUsers=t.topUsers.map((function(t){return t.id!==e?t:Object(a["a"])(Object(a["a"])({},t),{},{followerCount:t.followerCount-1,isFollowed:!1})})),r.next=14;break;case 11:r.prev=11,r.t0=r["catch"](0),u["a"].fire({icon:"error",title:"無法取消追蹤，請稍後再試"});case 14:case"end":return r.stop()}}),r,null,[[0,11]])})))()},followAction:function(e){this.topUsers=this.topUsers.map((function(t){return t.id!==e.userId?t:Object(a["a"])(Object(a["a"])({},t),{},{isFollowed:"follow"===e.type})}))}}},w=d,p=(r("46ed"),r("2877")),f=Object(p["a"])(w,n,s,!1,null,null,null);t["a"]=f.exports},a006:function(e,t,r){"use strict";r("0972")},c058:function(e,t,r){"use strict";var n=r("2fa3"),s=function(){return localStorage.getItem("token")};t["a"]={likeTweet:function(e){var t=e.tweetId;return n["b"].post("/tweets/".concat(t,"/like"),null,{headers:{Authorization:"Bearer ".concat(s())}})},unlikeTweet:function(e){var t=e.tweetId;return n["b"].post("/tweets/".concat(t,"/unlike"),null,{headers:{Authorization:"Bearer ".concat(s())}})}}},ca8f:function(e,t,r){},cd56:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[r("Navbar"),r("div",{staticClass:"main-container"},[r("div",{staticClass:"title"},[e._v("首頁")]),r("div",{staticClass:"post-tweet"},[r("form",{staticClass:"content-wrapper"},[r("div",{staticClass:"avatar",style:{background:"url("+e.currentUser.avatar+") no-repeat center/cover"},on:{click:function(t){e.$router.push("/user/self").catch((function(){}))}}}),r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.tweetDescription,expression:"tweetDescription"}],staticClass:"content",attrs:{placeholder:"有什麼新鮮事？"},domProps:{value:e.tweetDescription},on:{input:function(t){t.target.composing||(e.tweetDescription=t.target.value)}}}),r("button",{staticClass:"btn btn-tweet",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.postTweet(e.tweetDescription)}}},[e._v("推文")])])]),r("div",{staticClass:"divider"}),r("TweetList",{attrs:{tweets:e.tweets},on:{tweetAction:e.tweetAction}})],1),r("RecommendUsers")],1)},s=[],i=(r("a4d3"),r("e01a"),r("d81d"),r("fb6a"),r("b0c0"),r("96cf"),r("1da1")),a=r("5530"),o=r("d178"),c=r("88fd"),u=r("4c78"),l=r("6783"),d=r("2fa3"),w=r("2f62"),p=r("81b0"),f=r.n(p),h={name:"Main",components:{Navbar:o["a"],RecommendUsers:c["a"],TweetList:u["a"]},computed:Object(a["a"])({},Object(w["b"])(["currentUser","isAuthenticated"])),data:function(){return{tweets:[],tweetDescription:""}},watch:{tweetDescription:function(){this.checkTextLength()}},created:function(){var e=this;this.$bus.$on("tweetAction",(function(t){e.tweetAction(t)})),this.$bus.$on("renewTweets",(function(t){"/main"===e.$route.path&&e.fetchTweets(t)})),this.fetchTweets()},beforeDestroy:function(){this.$bus.$off("tweetAction"),this.$bus.$off("renewTweets")},methods:{checkTextLength:f.a.debounce((function(){this.tweetDescription.length>139&&(this.tweetDescription=this.tweetDescription.slice(0,139),d["a"].fire({icon:"error",title:"推文字數已達上限"}))}),1e3),fetchTweets:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$loading.show({isFullPage:!0,opacity:1},{default:e.$createElement("MyLoading")}),t.prev=1,t.next=4,l["a"].getTweets();case 4:n=t.sent,s=n.data,e.tweets=s.map((function(e){return{id:e.id,userId:e.User.id,name:e.User.name,avatar:e.User.avatar,account:e.User.account,createdAt:e.createdAt,description:e.description,likeTweetCount:e.likeTweetCount,replyTweetCount:e.replyTweetCount,isLiked:e.isLiked}})),e.tweets.sort((function(e,t){return e.createdAt<t.createdAt?1:-1})),r.hide(),t.next=16;break;case 11:t.prev=11,t.t0=t["catch"](1),r.hide(),console.log(t.t0),d["a"].fire({icon:"error",title:"目前無法取得推文，請稍候"});case 16:case"end":return t.stop()}}),t,null,[[1,11]])})))()},tweetAction:function(e){this.tweets=this.tweets.map((function(t){return t.id!==e.tweetId?t:Object(a["a"])(Object(a["a"])({},t),{},{likeTweetCount:"like"===e.type?t.likeTweetCount+1:t.likeTweetCount-1,isLiked:!t.isLiked})}))},postTweet:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,e){r.next=4;break}return d["a"].fire({icon:"error",title:"請輸入內容"}),r.abrupt("return");case 4:if(!(e.length>140)){r.next=7;break}return d["a"].fire({icon:"error",title:"推文字數需在140內"}),r.abrupt("return");case 7:return r.next=9,l["a"].postTweet({description:e});case 9:if(n=r.sent,s=n.data,"success"===s.status){r.next=13;break}throw new Error(s.message);case 13:return t.$socket.emit("tweet notification",{senderId:t.currentUser.id,titleData:"".concat(t.currentUser.name," 有新的推文"),contentData:e,url:"/reply_list/".concat(s.tweetId),type:"tweet"}),r.next=16,t.fetchTweets();case 16:t.tweets.sort((function(e,t){return e.createdAt<t.createdAt?1:-1})),t.tweetDescription="",t.showNewTweetModal=!1,r.next=25;break;case 21:r.prev=21,r.t0=r["catch"](0),console.log(r.t0),d["a"].fire({icon:"error",title:"目前無法推文，請稍候"});case 25:case"end":return r.stop()}}),r,null,[[0,21]])})))()}}},v=h,m=(r("a006"),r("2877")),b=Object(m["a"])(v,n,s,!1,null,null,null);t["default"]=b.exports},d81d:function(e,t,r){"use strict";var n=r("23e7"),s=r("b727").map,i=r("1dde"),a=r("ae40"),o=i("map"),c=a("map");n({target:"Array",proto:!0,forced:!o||!c},{map:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-4ea5de81.4f62c1f5.js.map