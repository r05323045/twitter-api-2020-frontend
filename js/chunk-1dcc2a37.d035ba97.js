(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1dcc2a37"],{"0465":function(e,t,r){"use strict";r("e71b")},1276:function(e,t,r){"use strict";var n=r("d784"),s=r("44e7"),a=r("825a"),i=r("1d80"),o=r("4840"),c=r("8aa5"),u=r("50c4"),l=r("14c3"),d=r("9263"),h=r("d039"),f=[].push,v=Math.min,p=4294967295,g=!h((function(){return!RegExp(p,"y")}));n("split",2,(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=String(i(this)),a=void 0===r?p:r>>>0;if(0===a)return[];if(void 0===e)return[n];if(!s(e))return t.call(n,e,a);var o,c,u,l=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),v=0,g=new RegExp(e.source,h+"g");while(o=d.call(g,n)){if(c=g.lastIndex,c>v&&(l.push(n.slice(v,o.index)),o.length>1&&o.index<n.length&&f.apply(l,o.slice(1)),u=o[0].length,v=c,l.length>=a))break;g.lastIndex===o.index&&g.lastIndex++}return v===n.length?!u&&g.test("")||l.push(""):l.push(n.slice(v)),l.length>a?l.slice(0,a):l}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t.call(this,e,r)}:t,[function(t,r){var s=i(this),a=void 0==t?void 0:t[e];return void 0!==a?a.call(t,s,r):n.call(String(s),t,r)},function(e,s){var i=r(n,e,this,s,n!==t);if(i.done)return i.value;var d=a(e),h=String(this),f=o(d,RegExp),m=d.unicode,C=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(g?"y":"g"),y=new f(g?d:"^(?:"+d.source+")",C),b=void 0===s?p:s>>>0;if(0===b)return[];if(0===h.length)return null===l(y,h)?[h]:[];var x=0,U=0,E=[];while(U<h.length){y.lastIndex=g?U:0;var w,T=l(y,g?h:h.slice(U));if(null===T||(w=v(u(y.lastIndex+(g?0:U)),h.length))===x)U=c(h,U,m);else{if(E.push(h.slice(x,U)),E.length===b)return E;for(var _=1;_<=T.length-1;_++)if(E.push(T[_]),E.length===b)return E;U=x=w}}return E.push(h.slice(x)),E}]}),!g)},"14c3":function(e,t,r){var n=r("c6b6"),s=r("9263");e.exports=function(e,t){var r=e.exec;if("function"===typeof r){var a=r.call(e,t);if("object"!==typeof a)throw TypeError("RegExp exec method returned something other than an Object or null");return a}if("RegExp"!==n(e))throw TypeError("RegExp#exec called on incompatible receiver");return s.call(e,t)}},2532:function(e,t,r){"use strict";var n=r("23e7"),s=r("5a34"),a=r("1d80"),i=r("ab13");n({target:"String",proto:!0,forced:!i("includes")},{includes:function(e){return!!~String(a(this)).indexOf(s(e),arguments.length>1?arguments[1]:void 0)}})},2909:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r("6b75");function s(e){if(Array.isArray(e))return Object(n["a"])(e)}r("a4d3"),r("e01a"),r("d28b"),r("a630"),r("d3b7"),r("3ca3"),r("ddb0");function a(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}var i=r("06c5");function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){return s(e)||a(e)||Object(i["a"])(e)||o()}},"44e7":function(e,t,r){var n=r("861d"),s=r("c6b6"),a=r("b622"),i=a("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[i])?!!t:"RegExp"==s(e))}},"498a":function(e,t,r){"use strict";var n=r("23e7"),s=r("58a8").trim,a=r("c8d2");n({target:"String",proto:!0,forced:a("trim")},{trim:function(){return s(this)}})},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,r){var n=r("1d80"),s=r("5899"),a="["+s+"]",i=RegExp("^"+a+a+"*"),o=RegExp(a+a+"*$"),c=function(e){return function(t){var r=String(n(t));return 1&e&&(r=r.replace(i,"")),2&e&&(r=r.replace(o,"")),r}};e.exports={start:c(1),end:c(2),trim:c(3)}},"5a34":function(e,t,r){var n=r("44e7");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},6062:function(e,t,r){"use strict";var n=r("6d61"),s=r("6566");e.exports=n("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),s)},6566:function(e,t,r){"use strict";var n=r("9bf2").f,s=r("7c73"),a=r("e2cc"),i=r("0366"),o=r("19aa"),c=r("2266"),u=r("7dd0"),l=r("2626"),d=r("83ab"),h=r("f183").fastKey,f=r("69f3"),v=f.set,p=f.getterFor;e.exports={getConstructor:function(e,t,r,u){var l=e((function(e,n){o(e,l,t),v(e,{type:t,index:s(null),first:void 0,last:void 0,size:0}),d||(e.size=0),void 0!=n&&c(n,e[u],{that:e,AS_ENTRIES:r})})),f=p(t),g=function(e,t,r){var n,s,a=f(e),i=m(e,t);return i?i.value=r:(a.last=i={index:s=h(t,!0),key:t,value:r,previous:n=a.last,next:void 0,removed:!1},a.first||(a.first=i),n&&(n.next=i),d?a.size++:e.size++,"F"!==s&&(a.index[s]=i)),e},m=function(e,t){var r,n=f(e),s=h(t);if("F"!==s)return n.index[s];for(r=n.first;r;r=r.next)if(r.key==t)return r};return a(l.prototype,{clear:function(){var e=this,t=f(e),r=t.index,n=t.first;while(n)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete r[n.index],n=n.next;t.first=t.last=void 0,d?t.size=0:e.size=0},delete:function(e){var t=this,r=f(t),n=m(t,e);if(n){var s=n.next,a=n.previous;delete r.index[n.index],n.removed=!0,a&&(a.next=s),s&&(s.previous=a),r.first==n&&(r.first=s),r.last==n&&(r.last=a),d?r.size--:t.size--}return!!n},forEach:function(e){var t,r=f(this),n=i(e,arguments.length>1?arguments[1]:void 0,3);while(t=t?t.next:r.first){n(t.value,t.key,this);while(t&&t.removed)t=t.previous}},has:function(e){return!!m(this,e)}}),a(l.prototype,r?{get:function(e){var t=m(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),d&&n(l.prototype,"size",{get:function(){return f(this).size}}),l},setStrong:function(e,t,r){var n=t+" Iterator",s=p(t),a=p(n);u(e,t,(function(e,t){v(this,{type:n,target:e,state:s(e),kind:t,last:void 0})}),(function(){var e=a(this),t=e.kind,r=e.last;while(r&&r.removed)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),l(t)}}},"6d61":function(e,t,r){"use strict";var n=r("23e7"),s=r("da84"),a=r("94ca"),i=r("6eeb"),o=r("f183"),c=r("2266"),u=r("19aa"),l=r("861d"),d=r("d039"),h=r("1c7e"),f=r("d44e"),v=r("7156");e.exports=function(e,t,r){var p=-1!==e.indexOf("Map"),g=-1!==e.indexOf("Weak"),m=p?"set":"add",C=s[e],y=C&&C.prototype,b=C,x={},U=function(e){var t=y[e];i(y,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!l(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:function(e,r){return t.call(this,0===e?0:e,r),this})};if(a(e,"function"!=typeof C||!(g||y.forEach&&!d((function(){(new C).entries().next()})))))b=r.getConstructor(t,e,p,m),o.REQUIRED=!0;else if(a(e,!0)){var E=new b,w=E[m](g?{}:-0,1)!=E,T=d((function(){E.has(1)})),_=h((function(e){new C(e)})),I=!g&&d((function(){var e=new C,t=5;while(t--)e[m](t,t);return!e.has(-0)}));_||(b=t((function(t,r){u(t,b,e);var n=v(new C,t,b);return void 0!=r&&c(r,n[m],{that:n,AS_ENTRIES:p}),n})),b.prototype=y,y.constructor=b),(T||I)&&(U("delete"),U("has"),p&&U("get")),(I||w)&&U(m),g&&y.clear&&delete y.clear}return x[e]=b,n({global:!0,forced:b!=C},x),f(b,e),g||r.setStrong(b,e,p),b}},7156:function(e,t,r){var n=r("861d"),s=r("d2bb");e.exports=function(e,t,r){var a,i;return s&&"function"==typeof(a=t.constructor)&&a!==r&&n(i=a.prototype)&&i!==r.prototype&&s(e,i),e}},"81d5":function(e,t,r){"use strict";var n=r("7b0b"),s=r("23cb"),a=r("50c4");e.exports=function(e){var t=n(this),r=a(t.length),i=arguments.length,o=s(i>1?arguments[1]:void 0,r),c=i>2?arguments[2]:void 0,u=void 0===c?r:s(c,r);while(u>o)t[o++]=e;return t}},"8aa5":function(e,t,r){"use strict";var n=r("6547").charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},9263:function(e,t,r){"use strict";var n=r("ad6d"),s=r("9f7f"),a=RegExp.prototype.exec,i=String.prototype.replace,o=a,c=function(){var e=/a/,t=/b*/g;return a.call(e,"a"),a.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),u=s.UNSUPPORTED_Y||s.BROKEN_CARET,l=void 0!==/()??/.exec("")[1],d=c||l||u;d&&(o=function(e){var t,r,s,o,d=this,h=u&&d.sticky,f=n.call(d),v=d.source,p=0,g=e;return h&&(f=f.replace("y",""),-1===f.indexOf("g")&&(f+="g"),g=String(e).slice(d.lastIndex),d.lastIndex>0&&(!d.multiline||d.multiline&&"\n"!==e[d.lastIndex-1])&&(v="(?: "+v+")",g=" "+g,p++),r=new RegExp("^(?:"+v+")",f)),l&&(r=new RegExp("^"+v+"$(?!\\s)",f)),c&&(t=d.lastIndex),s=a.call(h?r:d,g),h?s?(s.input=s.input.slice(p),s[0]=s[0].slice(p),s.index=d.lastIndex,d.lastIndex+=s[0].length):d.lastIndex=0:c&&s&&(d.lastIndex=d.global?s.index+s[0].length:t),l&&s&&s.length>1&&i.call(s[0],r,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(s[o]=void 0)})),s}),e.exports=o},"99af":function(e,t,r){"use strict";var n=r("23e7"),s=r("d039"),a=r("e8b5"),i=r("861d"),o=r("7b0b"),c=r("50c4"),u=r("8418"),l=r("65f0"),d=r("1dde"),h=r("b622"),f=r("2d00"),v=h("isConcatSpreadable"),p=9007199254740991,g="Maximum allowed index exceeded",m=f>=51||!s((function(){var e=[];return e[v]=!1,e.concat()[0]!==e})),C=d("concat"),y=function(e){if(!i(e))return!1;var t=e[v];return void 0!==t?!!t:a(e)},b=!m||!C;n({target:"Array",proto:!0,forced:b},{concat:function(e){var t,r,n,s,a,i=o(this),d=l(i,0),h=0;for(t=-1,n=arguments.length;t<n;t++)if(a=-1===t?i:arguments[t],y(a)){if(s=c(a.length),h+s>p)throw TypeError(g);for(r=0;r<s;r++,h++)r in a&&u(d,h,a[r])}else{if(h>=p)throw TypeError(g);u(d,h++,a)}return d.length=h,d}})},"9f7f":function(e,t,r){"use strict";var n=r("d039");function s(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=n((function(){var e=s("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=n((function(){var e=s("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},a582:function(e,t,r){"use strict";r("c724")},a9e3:function(e,t,r){"use strict";var n=r("83ab"),s=r("da84"),a=r("94ca"),i=r("6eeb"),o=r("5135"),c=r("c6b6"),u=r("7156"),l=r("c04e"),d=r("d039"),h=r("7c73"),f=r("241c").f,v=r("06cf").f,p=r("9bf2").f,g=r("58a8").trim,m="Number",C=s[m],y=C.prototype,b=c(h(y))==m,x=function(e){var t,r,n,s,a,i,o,c,u=l(e,!1);if("string"==typeof u&&u.length>2)if(u=g(u),t=u.charCodeAt(0),43===t||45===t){if(r=u.charCodeAt(2),88===r||120===r)return NaN}else if(48===t){switch(u.charCodeAt(1)){case 66:case 98:n=2,s=49;break;case 79:case 111:n=8,s=55;break;default:return+u}for(a=u.slice(2),i=a.length,o=0;o<i;o++)if(c=a.charCodeAt(o),c<48||c>s)return NaN;return parseInt(a,n)}return+u};if(a(m,!C(" 0o1")||!C("0b1")||C("+0x1"))){for(var U,E=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof E&&(b?d((function(){y.valueOf.call(r)})):c(r)!=m)?u(new C(x(t)),r,E):x(t)},w=n?f(C):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),T=0;w.length>T;T++)o(C,U=w[T])&&!o(E,U)&&p(E,U,v(C,U));E.prototype=y,y.constructor=E,i(s,m,E)}},ab13:function(e,t,r){var n=r("b622"),s=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[s]=!1,"/./"[e](t)}catch(n){}}return!1}},ac1f:function(e,t,r){"use strict";var n=r("23e7"),s=r("9263");n({target:"RegExp",proto:!0,forced:/./.exec!==s},{exec:s})},ae72:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"private-main"},[r("Navbar"),r("div",{staticClass:"private-container"},[r("PrivateChatroom")],1)],1)},s=[],a=r("5530"),i=r("d178"),o=r("2f62"),c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chat-room"},[r("div",{staticClass:"chat-users"},[e._m(0),e.historyChatUsers.length>0?r("div",{staticClass:"list-group"},e._l(e.historyChatUsers,(function(t,n){return r("div",{key:""+(t.id+Math.random()),staticClass:"list-group-item",on:{click:function(r){return e.controlActive(t,n)}}},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.messengeActive[n],expression:"messengeActive[idx]"}],staticClass:"active-bar"}),r("div",{staticClass:"avatar",style:{background:"url("+(t?t.avatar:"")+") no-repeat center/cover"},on:{click:function(r){e.$router.push("/user/other/"+t.id).catch((function(){}))}}}),r("div",{staticClass:"info"},[r("div",{staticClass:"name",on:{click:function(r){e.$router.push("/user/other/"+t.id).catch((function(){}))}}},[e._v(e._s(t.name))]),r("div",{staticClass:"account",on:{click:function(r){e.$router.push("/user/other/"+t.id).catch((function(){}))}}},[e._v(e._s(t.account))])]),t.unread>0?r("div",{staticClass:"unread-wrapper"},[r("div",{staticClass:"unread"},[e._v(e._s(t.unread))])]):e._e()])})),0):e._e()]),r("PrivateMessengeBoard",{attrs:{userChatTo:e.userChatTo,messages:e.histroyMessages,targetChannel:e.targetChannel},on:{sendPrivateMessage:e.receiveMessage}})],1)},u=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"title"},[e._v(" 訊息 "),r("div",{staticClass:"icon messege"})])}],l=(r("99af"),r("cb29"),r("4de4"),r("4160"),r("a630"),r("caad"),r("c975"),r("d81d"),r("a9e3"),r("d3b7"),r("ac1f"),r("6062"),r("2532"),r("3ca3"),r("1276"),r("159b"),r("ddb0"),r("96cf"),r("1da1")),d=r("2909"),h=r("2fa3"),f=r("2313"),v=r("4cce"),p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"messenge-board"},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.userChatTo.id,expression:"userChatTo.id"}]},[r("div",{staticClass:"top-wrapper"},[r("div",{staticClass:"info"},[r("div",{staticClass:"name",on:{click:function(t){e.$router.push("/user/other/"+e.userChatTo.id).catch((function(){}))}}},[e._v(e._s(e.userChatTo.name))]),r("div",{staticClass:"account",on:{click:function(t){e.$router.push("/user/other/"+e.userChatTo.id).catch((function(){}))}}},[e._v(e._s(e.userChatTo.account))])])]),r("div",{ref:"boardWrapper",staticClass:"board-wrapper",on:{click:e.scrollToBottom}},[r("div",{staticClass:"messages"},e._l(e.messages,(function(t,n){return r("div",{key:"msg-"+n},["userComein"===t.type&&e.currentUser.id!==t.UserId?r("div",{staticClass:"broacast-message-wrapper"},[r("div",{staticClass:"broacast-message"},[e._v(e._s(t.message))])]):e._e(),"userComein"!==t.type&&e.currentUser.id!==t.UserId?r("div",{staticClass:"other message"},[r("div",{staticClass:"avatar",style:{background:"url("+(t.User?t.User.avatar:t.avatar)+") no-repeat center/cover"}}),r("div",{staticClass:"wrapper"},[r("div",{staticClass:"text"},[e._v(e._s(t.message))]),r("div",{staticClass:"time"},[e._v(e._s(e._f("fromNow")(t.createdAt)))])])]):e._e(),"userComein"!==t.type&&e.currentUser.id===t.UserId?r("div",{staticClass:"self message"},[r("div",{staticClass:"text"},[e._v(e._s(t.message))]),r("div",{staticClass:"time"},[e._v(e._s(e._f("fromNow")(t.createdAt)))])]):e._e()])})),0)]),r("form",{on:{submit:function(t){return t.preventDefault(),e.sendMessage(t)},click:e.scrollToBottom}},[r("div",{staticClass:"text-wrapper"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"text",attrs:{placeholder:"輸入訊息...",onfocus:"this.placeholder = ''",onblur:"this.placeholder = '輸入訊息...'"},domProps:{value:e.message},on:{input:function(t){t.target.composing||(e.message=t.target.value)}}}),r("div",{staticClass:"icon-wrapper",attrs:{type:"submit"},on:{click:e.sendMessage}},[r("div",{staticClass:"icon send"})])])])]),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.userChatTo.id,expression:"!userChatTo.id"}],staticClass:"no-message-noti"},[r("div",[e._v("你沒有任何訊息")])])])},g=[],m=(r("498a"),{props:{userChatTo:{type:Object},messages:{type:Array},targetChannel:{type:String}},data:function(){return{message:""}},mounted:function(){var e=this;this.$socket.on("private_msg",(function(t){e.$emit("sendPrivateMessage",{UserId:t.UserId,avatar:t.avatar,message:t.message,createdAt:t.createdAt,type:t.type,User:t.User,sendTo:t.sendTo,targetChannel:e.targetChannel});var r=e.$refs.boardWrapper;r&&(r.scrollTop=r.scrollHeight,r.animate({scrollTop:r.scrollHeight}))})),this.$socket.on("unread_msg",(function(t){t.sendTo===e.currentUser.id&&t.UserId!==e.userChatTo.id&&e.$bus.$emit("updateChatUsers",t)}))},beforeDestroy:function(){},watch:{messages:function(){this.scrollToBottom()},userChatTo:function(){this.scrollToBottom()},targetChannel:function(){this.scrollToBottom()}},updated:function(){this.scrollToBottom()},computed:Object(a["a"])({},Object(o["b"])(["currentUser","isAuthenticated"])),methods:{scrollToBottom:function(){var e=this.$refs.boardWrapper;e&&(e.scrollTop=e.scrollHeight,e.animate({scrollTop:e.scrollHeight}))},sendMessage:function(e){if(e.preventDefault(),""!==this.message.trim()){this.$socket.emit("private message",{UserId:this.currentUser.id,avatar:this.currentUser.avatar,message:this.message,createdAt:new Date,type:"chat",User:this.currentUser,sendTo:this.userChatTo.id,targetChannel:this.targetChannel}),this.message="";var t=this.$refs.boardWrapper;t&&(t.scrollTop=t.scrollHeight,t.animate({scrollTop:t.scrollHeight}))}else h["a"].fire({icon:"error",title:"請輸入訊息"})}}}),C=m,y=(r("0465"),r("2877")),b=Object(y["a"])(C,p,g,!1,null,null,null),x=b.exports,U={components:{PrivateMessengeBoard:x},data:function(){return{messengeActive:[],userChatTo:{},historyChatUsers:[],historyChatUserId:[],allHistoryMessages:[],histroyMessages:[],unreadMessages:[],targetChannel:"",users:[]}},created:function(){var e=this;return this.$bus.$on("updateChatUsers",(function(t){e.updateChatUsers(t),e.readMessages(e.userChatTo.id)})),Promise.all([this.fetchUsers(),this.fetchChatroom()]).then((function(){if(e.messengeActive=new Array(e.historyChatUsers.length).fill(!1),e.$route.query.id){e.userChatTo=e.historyChatUsers.filter((function(t){return t.id===Number(e.$route.query.id)}))[0];var t=e.historyChatUsers.map((function(e){return e.id})).indexOf(Number(e.$route.query.id));e.messengeActive[t]=!0}else e.userChatTo=Object.assign({},e.historyChatUsers[0]?e.historyChatUsers[0]:{}),e.messengeActive[0]=!0;e.historyChatUsers.length>0&&(e.historyChatUsers[0].unread=0,e.targetChannel=Number(e.userChatTo.id)>Number(e.currentUser.id)?"".concat(e.currentUser.id,"_").concat(e.userChatTo.id):"".concat(e.userChatTo.id,"_").concat(e.currentUser.id),e.histroyMessages=e.allHistoryMessages.filter((function(t){return t.targetChannel===e.targetChannel})),e.readMessages(e.userChatTo.id),e.$socket.emit("private chatroom",e.targetChannel))}))},beforeDestroy:function(){this.$socket.emit("leave private chatroom",this.targetChannel),this.readMessages(this.userChatTo.id),this.$bus.$off("updateChatUsers")},computed:Object(a["a"])({},Object(o["b"])(["currentUser","isAuthenticated"])),watch:{historyChatUsers:function(){}},methods:{receiveMessage:function(e){var t=this;this.allHistoryMessages=[].concat(Object(d["a"])(this.allHistoryMessages),[e]),this.histroyMessages=this.allHistoryMessages.filter((function(e){return e.targetChannel===t.targetChannel}))},controlActive:function(e,t){var r=this;this.messengeActive=new Array(this.historyChatUsers.length).fill(!1),this.messengeActive[t]=!0,this.readMessages(this.userChatTo.id),this.userChatTo=Object.assign({},e),this.$socket.emit("leave private chatroom",this.targetChannel),this.targetChannel=Number(this.userChatTo.id)>Number(this.currentUser.id)?"".concat(this.currentUser.id,"_").concat(this.userChatTo.id):"".concat(this.userChatTo.id,"_").concat(this.currentUser.id),this.histroyMessages=this.allHistoryMessages.filter((function(e){return e.targetChannel===r.targetChannel})),this.readMessages(this.userChatTo.id);var n=this.historyChatUsers.map((function(e){return e.id})).indexOf(e.id);this.historyChatUsers[n].unread=0,this.$socket.emit("private chatroom",this.targetChannel)},fetchChatroom:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var r,n,s,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$loading.show({isFullPage:!0,opacity:1},{default:e.$createElement("MyLoading")}),t.prev=1,t.next=4,f["a"].getChatRoom();case 4:n=t.sent,s=n.data,e.allHistoryMessages=s.histroy.filter((function(e){return"chat"===e.type&&"0"!==e.targetChannel})),e.allHistoryMessages&&(a=e.allHistoryMessages.map((function(e){return e.targetChannel})).map((function(e){return e.split("_")})).filter((function(e){return e.length>1})).filter((function(t){return t.includes(String(e.currentUser.id))})),a.forEach((function(t){e.historyChatUserId.push(t[0]===String(e.currentUser.id)?Number(t[1]):Number(t[0]))}))),e.historyChatUserId=Array.from(new Set(e.historyChatUserId)),e.$route.query&&(e.historyChatUserId=e.historyChatUserId.includes(Number(e.$route.query.id))?e.historyChatUserId:[].concat(Object(d["a"])(e.historyChatUserId),[Number(e.$route.query.id)])),e.historyChatUsers=e.users.filter((function(t){return e.historyChatUserId.includes(t.id)})),e.historyChatUsers.forEach((function(t){var r=Number(t.id)>Number(e.currentUser.id)?"".concat(e.currentUser.id,"_").concat(t.id):"".concat(t.id,"_").concat(e.currentUser.id),n=e.allHistoryMessages.filter((function(e){return e.targetChannel===r}));n.length>0?(n.sort((function(e,t){return e.createdAt<t.createdAt?1:-1})),t.lastChat=n[0].createdAt):t.lastChat=Date.now(),n.length>0&&(t.unread=n.filter((function(t){return!1===t.isRead&&t.sendTo===e.currentUser.id})).length)})),e.historyChatUsers.sort((function(e,t){return e.lastChat<t.lastChat?1:-1})),i=e.$refs.boardWrapper,i&&(i.scrollTop=i.scrollHeight,i.animate({scrollTop:i.scrollHeight})),r.hide(),t.next=23;break;case 18:t.prev=18,t.t0=t["catch"](1),r.hide(),console.log(t.t0),h["a"].fire({icon:"error",title:"目前無法連線聊天室，請稍候"});case 23:case"end":return t.stop()}}),t,null,[[1,18]])})))()},fetchUsers:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$loading.show({isFullPage:!0,opacity:1},{default:e.$createElement("MyLoading")}),t.prev=1,t.next=4,v["a"].getUsers();case 4:return n=t.sent,s=n.data,e.users=s,r.hide(),t.abrupt("return",s);case 11:t.prev=11,t.t0=t["catch"](1),r.hide(),console.log(t.t0),h["a"].fire({icon:"error",title:"目前無法取得資料，請稍候"});case 16:case"end":return t.stop()}}),t,null,[[1,11]])})))()},readMessages:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,f["a"].readMessages({userId:e});case 3:if(n=r.sent,s=n.data,"success"===s.status){r.next=7;break}throw new Error(s.message);case 7:t.$bus.$emit("updateUnreadMessages"),r.next=14;break;case 10:r.prev=10,r.t0=r["catch"](0),console.log(r.t0),h["a"].fire({icon:"error",title:"目前無法已讀訊息，請稍候"});case 14:case"end":return r.stop()}}),r,null,[[0,10]])})))()},updateChatUsers:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.allHistoryMessages=[].concat(Object(d["a"])(t.allHistoryMessages),[e]),t.historyChatUsers.map((function(e){return e.id})).includes(e.UserId)||(n=e.User,n.lastChat=e.createdAt,n.unread=0,t.historyChatUsers=[].concat(Object(d["a"])(t.historyChatUsers),[n]),t.historyChatUsers.sort((function(e,t){return e.lastChat<t.lastChat?1:-1})),t.messengeActive=new Array(t.historyChatUsers.length).fill(!1),s=t.historyChatUsers.map((function(e){return e.id})).indexOf(Number(t.userChatTo.id)),t.messengeActive[s]=!0),t.historyChatUsers=t.historyChatUsers.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{unread:e.UserId===t.id?t.unread+=1:t.unread})}));case 3:case"end":return r.stop()}}),r)})))()}}},E=U,w=(r("f24e"),Object(y["a"])(E,c,u,!1,null,null,null)),T=w.exports,_={components:{Navbar:i["a"],PrivateChatroom:T},computed:Object(a["a"])({},Object(o["b"])(["currentUser","isAuthenticated"]))},I=_,A=(r("a582"),Object(y["a"])(I,n,s,!1,null,null,null));t["default"]=A.exports},bb2f:function(e,t,r){var n=r("d039");e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},c724:function(e,t,r){},c8d2:function(e,t,r){var n=r("d039"),s=r("5899"),a="​᠎";e.exports=function(e){return n((function(){return!!s[e]()||a[e]()!=a||s[e].name!==e}))}},c975:function(e,t,r){"use strict";var n=r("23e7"),s=r("4d64").indexOf,a=r("a640"),i=r("ae40"),o=[].indexOf,c=!!o&&1/[1].indexOf(1,-0)<0,u=a("indexOf"),l=i("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:c||!u||!l},{indexOf:function(e){return c?o.apply(this,arguments)||0:s(this,e,arguments.length>1?arguments[1]:void 0)}})},caad:function(e,t,r){"use strict";var n=r("23e7"),s=r("4d64").includes,a=r("44d2"),i=r("ae40"),o=i("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:!o},{includes:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),a("includes")},cb29:function(e,t,r){var n=r("23e7"),s=r("81d5"),a=r("44d2");n({target:"Array",proto:!0},{fill:s}),a("fill")},d784:function(e,t,r){"use strict";r("ac1f");var n=r("6eeb"),s=r("d039"),a=r("b622"),i=r("9263"),o=r("9112"),c=a("species"),u=!s((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),l=function(){return"$0"==="a".replace(/./,"$0")}(),d=a("replace"),h=function(){return!!/./[d]&&""===/./[d]("a","$0")}(),f=!s((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}));e.exports=function(e,t,r,d){var v=a(e),p=!s((function(){var t={};return t[v]=function(){return 7},7!=""[e](t)})),g=p&&!s((function(){var t=!1,r=/a/;return"split"===e&&(r={},r.constructor={},r.constructor[c]=function(){return r},r.flags="",r[v]=/./[v]),r.exec=function(){return t=!0,null},r[v](""),!t}));if(!p||!g||"replace"===e&&(!u||!l||h)||"split"===e&&!f){var m=/./[v],C=r(v,""[e],(function(e,t,r,n,s){return t.exec===i?p&&!s?{done:!0,value:m.call(t,r,n)}:{done:!0,value:e.call(r,t,n)}:{done:!1}}),{REPLACE_KEEPS_$0:l,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:h}),y=C[0],b=C[1];n(String.prototype,e,y),n(RegExp.prototype,v,2==t?function(e,t){return b.call(e,this,t)}:function(e){return b.call(e,this)})}d&&o(RegExp.prototype[v],"sham",!0)}},d81d:function(e,t,r){"use strict";var n=r("23e7"),s=r("b727").map,a=r("1dde"),i=r("ae40"),o=a("map"),c=i("map");n({target:"Array",proto:!0,forced:!o||!c},{map:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})},e71b:function(e,t,r){},f183:function(e,t,r){var n=r("d012"),s=r("861d"),a=r("5135"),i=r("9bf2").f,o=r("90e3"),c=r("bb2f"),u=o("meta"),l=0,d=Object.isExtensible||function(){return!0},h=function(e){i(e,u,{value:{objectID:"O"+ ++l,weakData:{}}})},f=function(e,t){if(!s(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,u)){if(!d(e))return"F";if(!t)return"E";h(e)}return e[u].objectID},v=function(e,t){if(!a(e,u)){if(!d(e))return!0;if(!t)return!1;h(e)}return e[u].weakData},p=function(e){return c&&g.REQUIRED&&d(e)&&!a(e,u)&&h(e),e},g=e.exports={REQUIRED:!1,fastKey:f,getWeakData:v,onFreeze:p};n[u]=!0},f1c1:function(e,t,r){},f24e:function(e,t,r){"use strict";r("f1c1")}}]);
//# sourceMappingURL=chunk-1dcc2a37.d035ba97.js.map