(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-379340e7"],{"46ed":function(e,t,o){"use strict";o("ca8f")},"672f":function(e,t,o){},"791c":function(e,t,o){"use strict";o("672f")},8845:function(e,t,o){"use strict";var r=o("2fa3"),s=function(){return localStorage.getItem("token")};t["a"]={addFollowing:function(e){var t=e.userId;return r["b"].post("/followships",{id:t},{headers:{Authorization:"Bearer ".concat(s())}})},deleteFollowing:function(e){var t=e.userId;return r["b"].delete("/followships/".concat(t),{headers:{Authorization:"Bearer ".concat(s())}})}}},"88fd":function(e,t,o){"use strict";var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"recommend-users",style:[e.more?{height:71*e.topUsers.length+92+"px"}:{height:"447px"}]},[o("div",{staticClass:"title"},[e._v("跟隨誰")]),o("div",{staticClass:"list-group"},e._l(e.topUsers,(function(t,r){return o("div",{directives:[{name:"show",rawName:"v-show",value:!(!e.more&&r>4),expression:"!(!more && idx > 4)"}],key:t.id,staticClass:"list-group-item"},[o("div",{staticClass:"avatar",style:{background:"url("+t.avatar+") no-repeat center/cover"},on:{click:function(o){e.$router.push("/user/other/"+t.id).catch((function(){}))}}}),o("div",{staticClass:"info"},[o("div",{staticClass:"name",on:{click:function(o){e.$router.push("/user/other/"+t.id).catch((function(){}))}}},[e._v(e._s(t.name))]),o("div",{staticClass:"account",on:{click:function(o){e.$router.push("/user/other/"+t.id).catch((function(){}))}}},[e._v(e._s(t.account))])]),o("button",{directives:[{name:"show",rawName:"v-show",value:t.isFollowed,expression:"user.isFollowed"}],staticClass:"btn btn-follow unfollow",on:{click:function(o){return e.deleteFollowing(t.id)}}},[e._v("正在跟隨")]),o("button",{directives:[{name:"show",rawName:"v-show",value:!t.isFollowed,expression:"!user.isFollowed"}],staticClass:"btn btn-follow",on:{click:function(o){return e.addFollowing(t.id)}}},[e._v("跟隨")])])})),0),o("div",{directives:[{name:"show",rawName:"v-show",value:!e.more,expression:"!more"}],staticClass:"footer",on:{click:function(t){e.more=!e.more}}},[e._v("顯示更多")]),o("div",{directives:[{name:"show",rawName:"v-show",value:e.more,expression:"more"}],staticClass:"footer",on:{click:function(t){e.more=!e.more}}},[e._v("顯示更少")])])},s=[],n=(o("4de4"),o("d81d"),o("fb6a"),o("b0c0"),o("96cf"),o("1da1")),i=o("5530"),a=o("8845"),l=o("4cce"),c=o("2fa3"),u=o("2f62"),f={name:"RecommendUsers",data:function(){return{topUsers:[],more:!1}},created:function(){var e=this;this.fetchTopUsers(),this.$bus.$on("followAction",(function(t){e.followAction(t)}))},beforeDestroy:function(){this.$bus.$off("followAction")},computed:Object(i["a"])({},Object(u["b"])(["currentUser","isAuthenticated"])),methods:{fetchTopUsers:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var o,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=e.$loading.show({isFullPage:!0,opacity:1},{default:e.$createElement("MyLoading")}),t.prev=1,t.next=4,l["a"].getTopUsers();case 4:r=t.sent,s=r.data,e.topUsers=s.users.map((function(e){return{id:e.id,name:e.name,avatar:e.avatar,account:e.account,followerCount:e.FollowerCount,isFollowed:e.isFollowed}})).filter((function(t){return t.id!==e.currentUser.id})).slice(0,8),o.hide(),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](1),console.log(t.t0),c["a"].fire({icon:"error",title:"目前無法為你推薦追蹤，請稍候"});case 14:case"end":return t.stop()}}),t,null,[[1,10]])})))()},addFollowing:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function o(){var r,s;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,a["a"].addFollowing({userId:e});case 3:if(r=o.sent,s=r.data,"success"===s.status){o.next=7;break}throw new Error(s.message);case 7:t.$bus.$emit("followAction",{type:"follow",userId:e,followship:s.followship}),s.followship.followerId>0&&s.followship.followingId!==t.currentUser.id&&t.$socket.emit("personal notification",{senderId:t.currentUser.id,titleData:"".concat(t.currentUser.name," 開始追蹤你"),url:"/user/self/follower",type:"follow",recipientId:s.followship.followingId}),t.topUsers=t.topUsers.map((function(t){return t.id!==e?t:Object(i["a"])(Object(i["a"])({},t),{},{followerCount:t.followerCount+1,isFollowed:!0})})),o.next=15;break;case 12:o.prev=12,o.t0=o["catch"](0),c["a"].fire({icon:"error",title:"無法加入追蹤，請稍後再試"});case 15:case"end":return o.stop()}}),o,null,[[0,12]])})))()},deleteFollowing:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function o(){var r,s;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,a["a"].deleteFollowing({userId:e});case 3:if(r=o.sent,s=r.data,"success"===s.status){o.next=7;break}throw new Error(s.message);case 7:t.$bus.$emit("followAction",{type:"unfollow",userId:e}),t.topUsers=t.topUsers.map((function(t){return t.id!==e?t:Object(i["a"])(Object(i["a"])({},t),{},{followerCount:t.followerCount-1,isFollowed:!1})})),o.next=14;break;case 11:o.prev=11,o.t0=o["catch"](0),c["a"].fire({icon:"error",title:"無法取消追蹤，請稍後再試"});case 14:case"end":return o.stop()}}),o,null,[[0,11]])})))()},followAction:function(e){this.topUsers=this.topUsers.map((function(t){return t.id!==e.userId?t:Object(i["a"])(Object(i["a"])({},t),{},{isFollowed:"follow"===e.type})}))}}},d=f,w=(o("46ed"),o("2877")),h=Object(w["a"])(d,r,s,!1,null,null,null);t["a"]=h.exports},beea:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAcCAYAAAAEN20fAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAB5SURBVHgB7dfBCYAwEETR0Qoswc6SzreEpAPNQg5R4kGFnct8GMnNBwoi8L7UVtqsnyn5jY9hBYTuCJ8huBnClxGYEEIIIcRXRNTMDUs/7OBW13bZwK/6JYP7aAqGd/EJk0AoQxhhhBEmHkP5r5lhDMRyB1y+EX87AdxCwzt7prpuAAAAAElFTkSuQmCC"},ca8f:function(e,t,o){},cc77:function(e,t,o){"use strict";var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"follower-main"},[r("div",{staticClass:"upper"},[r("img",{staticClass:"arrow",attrs:{src:o("beea"),alt:""},on:{click:function(t){return e.$router.go(-1)}}}),r("div",{staticClass:"title"},[r("h3",[e._v(e._s(e.nowUser.name))]),e.nowUser.tweets?r("span",[e._v(e._s(e.nowUser.tweets.length)+" 推文")]):e._e()])]),this.$route.path.indexOf("/self")>0?r("div",{staticClass:"tab self"},[r("div",{staticClass:"item",class:{active:"/user/self/follower"===this.$route.path},on:{click:function(t){return e.$router.push("/user/self/follower")}}},[r("div",{staticClass:"text"},[e._v("追隨者")])]),r("div",{staticClass:"item",class:{active:"/user/self/following"===e.$route.path},on:{click:function(t){return e.$router.push("/user/self/following")}}},[r("div",{staticClass:"text"},[e._v("正在跟隨")])])]):e._e(),this.$route.path.indexOf("/self")>0?e._e():r("div",{staticClass:"tab ohter"},[r("div",{staticClass:"item",class:{active:this.$route.path.indexOf("follower")>0},on:{click:function(t){return e.$router.push("/user/other/"+e.nowUser.user.id+"/follower")}}},[r("div",{staticClass:"text"},[e._v("追隨者")])]),r("div",{staticClass:"item",class:{active:this.$route.path.indexOf("following")>0},on:{click:function(t){return e.$router.push("/user/other/"+e.nowUser.user.id+"/following")}}},[r("div",{staticClass:"text"},[e._v("正在跟隨")])])]),r("div",{staticClass:"followListContent"},[r("div",e._l(e.followers,(function(t){return r("div",{key:t.id,staticClass:"singleContent"},[t?r("img",{staticClass:"avatar",attrs:{src:t.avatar},on:{click:function(o){return e.$router.push("/user/other/"+t.id)}}}):e._e(),r("div",{staticClass:"text"},[t?r("h5",{staticClass:"title",on:{click:function(o){return e.$router.push("/user/other/"+t.id)}}},[e._v(e._s(t.name))]):e._e(),t?r("h5",{staticClass:"account",on:{click:function(o){return e.$router.push("/user/other/"+t.id)}}},[e._v(e._s(t.account))]):e._e(),t?r("p",{staticClass:"content"},[e._v(e._s(t.introduction))]):e._e()]),t&&t.id!==e.currentUser.id?r("button",{directives:[{name:"show",rawName:"v-show",value:t.isFollowed,expression:"follower.isFollowed"}],staticClass:"btn-follow unfollow",on:{click:function(o){return e.deleteFollowing(t.id)}}},[e._v(" 正在跟隨 ")]):e._e(),t&&t.id!==e.currentUser.id?r("button",{directives:[{name:"show",rawName:"v-show",value:!t.isFollowed,expression:"!follower.isFollowed"}],staticClass:"btn-follow",on:{click:function(o){return e.addFollowing(t.id)}}},[e._v(" 跟隨 ")]):e._e()])})),0)])])},s=[],n=(o("4160"),o("b0c0"),o("159b"),o("96cf"),o("1da1")),i=o("5530"),a=o("2fa3"),l=o("8845"),c=o("2f62"),u={data:function(){return{followers:[]}},props:{initialFollowers:{type:Array},nowUser:{type:Object}},watch:{initialFollowers:function(){this.followers=this.initialFollowers},nowUsers:function(){},deep:!0},created:function(){this.followers=this.initialFollowers},computed:Object(i["a"])({},Object(c["b"])(["currentUser","isAuthenticated"])),methods:{addFollowing:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function o(){var r,s;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,l["a"].addFollowing({userId:e});case 3:if(r=o.sent,s=r.data,"success"===s.status){o.next=7;break}throw new Error(s.message);case 7:s.followship.followerId>0&&s.followship.followingId!==t.currentUser.id&&t.$socket.emit("personal notification",{senderId:t.currentUser.id,titleData:"".concat(t.currentUser.name," 開始追蹤你"),url:"/user/self/follower",type:"follow",recipientId:s.followship.followingId}),t.$bus.$emit("followAction",{type:"follow",userId:e}),t.followers.forEach((function(t){t.id===e&&(t.isFollowed=!0)})),o.next=15;break;case 12:o.prev=12,o.t0=o["catch"](0),a["a"].fire({icon:"error",title:"無法加入追蹤，請稍後再試"});case 15:case"end":return o.stop()}}),o,null,[[0,12]])})))()},deleteFollowing:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function o(){var r,s;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,l["a"].deleteFollowing({userId:e});case 3:if(r=o.sent,s=r.data,"success"===s.status){o.next=7;break}throw new Error(s.message);case 7:t.$bus.$emit("followAction",{type:"unfollow",userId:e}),t.followers.forEach((function(t){t.id===e&&(t.isFollowed=!1)})),o.next=14;break;case 11:o.prev=11,o.t0=o["catch"](0),a["a"].fire({icon:"error",title:"無法取消追蹤，請稍後再試"});case 14:case"end":return o.stop()}}),o,null,[[0,11]])})))()}}},f=u,d=(o("791c"),o("2877")),w=Object(d["a"])(f,r,s,!1,null,null,null);t["a"]=w.exports},d81d:function(e,t,o){"use strict";var r=o("23e7"),s=o("b727").map,n=o("1dde"),i=o("ae40"),a=n("map"),l=i("map");r({target:"Array",proto:!0,forced:!a||!l},{map:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-379340e7.16c92889.js.map